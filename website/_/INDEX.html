<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nu-Metro Cinema</title>
    <style>
      /* General Styles */
      body {
        background-color: #000;
        color: #fff;
        font-family: "Poppins", sans-serif;
        margin: 0;
      }

      /* Navbar */
      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 18px 40px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .logo .n {
        width: 42px;
        height: 42px;
        border: 3px solid #ff9a35;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 26px;
        font-weight: 900;
        color: #ff9a35;
      }

      .logo .text {
        font-size: 24px;
        font-weight: 700;
        color: #ff9a35;
      }

      nav a {
        color: #fff;
        text-decoration: none;
        margin-left: 18px;
        font-weight: 600;
      }

      nav a:hover {
        color: #ff9a35;
      }

      /* Orange Divider Line */
      .orange-line {
        height: 4px;
        background: linear-gradient(90deg, #ff9a35, #ff7a00);
      }

      /* Hero Slider */
      .hero {
        text-align: center;
        padding: 20px;
        background: radial-gradient(circle, rgba(255, 154, 53, 0.25), #000 70%);
      }

      .hero-title {
        font-size: 30px;
        color: #ff9a35;
        margin-bottom: 10px;
      }

      .hero-slider {
        max-width: 500px;
        margin: 0 auto;
      }

      .hero-slider img {
        width: 100%;
        height: 300px;
        object-fit: cover;
        border-radius: 10px;
      }

      .dots {
        display: flex;
        justify-content: center;
        margin-top: 10px;
        gap: 6px;
      }

      .dot {
        width: 10px;
        height: 10px;
        background: #fff;
        border-radius: 50%;
        opacity: 0.5;
        cursor: pointer;
      }

      .dot.active {
        opacity: 1;
        background: #ff9a35;
      }

      /* Movie Grids */
      .grid,
      .upcoming-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        padding: 20px;
      }

      .movie-card {
        background-color: #111;
        border-radius: 10px;
        overflow: hidden;
        text-align: center;
      }

      .movie-card img {
        width: 100%;
        height: 240px;
        object-fit: cover;
      }

      .movie-info {
        padding: 10px;
      }

      .movie-info h4 {
        color: #ff9a35;
        margin: 6px 0;
      }

      .movie-info p {
        font-size: 13px;
        color: #ccc;
        margin: 4px 0;
      }

      .movie-info button {
        background-color: #fff;
        color: #000;
        border: none;
        padding: 8px 14px;
        border-radius: 8px;
        margin: 6px 4px;
        font-weight: 700;
        cursor: pointer;
      }

      .movie-info button:hover {
        background-color: #ff9a35;
        color: #fff;
      }

      /* Trailer Section */
      .trailer-section {
        background-color: #111;
        padding: 20px;
        margin: 20px;
        border-radius: 10px;
        text-align: center;
      }

      .trailer-section video {
        width: 100%;
        max-height: 300px;
        border-radius: 10px;
      }

      .trailer-buttons {
        margin-top: 10px;
      }

      .trailer-buttons button {
        margin: 0 10px;
        padding: 8px 14px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <header class="navbar">
      <div class="logo">
        <div class="n">N</div>
        <div class="text">uMetro</div>
      </div>
      <nav>
        <a href="#">SEATS</a>
        <a href="#">MOVIES</a>
      </nav>
    </header>
    <div class="orange-line"></div>

    <!-- Hero Slider -->
    <div class="hero">
      <div class="hero-title">Now Showing</div>
      <div class="hero-slider">
        <img id="heroImage" src="" alt="Featured Movie" />
      </div>
      <div class="dots" id="heroDots"></div>
    </div>

    <!-- Now Showing Movies -->
    <h2 style="text-align: center">Now Showing</h2>
    <div class="grid" id="movieGrid"></div>

    <!-- Trailer Section -->
    <h2 style="text-align: center">Trailers</h2>
    <div class="trailer-section">
      <video id="trailerPlayer" muted controls></video>
      <div class="trailer-buttons">
        <button id="watchTrailerBtn">Watch</button>
        <button id="nextTrailerBtn">Next</button>
      </div>
    </div>

    <!-- Upcoming Movies -->
    <h2 style="text-align: center">Upcoming Movies</h2>
    <div class="upcoming-grid" id="upcomingGrid"></div>

    <script>
      // ======= DATA FROM LOCAL STORAGE =======
      const nowShowingMovies = JSON.parse(localStorage.getItem("movies")) || [];
      const upcomingMoviesList =
        JSON.parse(localStorage.getItem("upcomingMovies")) || [];
      const trailersList = JSON.parse(localStorage.getItem("trailers")) || [];

      // Combine all movies that have trailers
      const allTrailers = [
        ...trailersList,
        ...nowShowingMovies,
        ...upcomingMoviesList,
      ].filter((movie) => movie.trailerUrl);

      // Placeholder for missing poster
      const placeholder =
        "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='450'><rect width='100%' height='100%' fill='%23111'/><text x='50%' y='50%' fill='%23FF9A35' font-size='20' text-anchor='middle'>No Poster</text></svg>";

      // ======= HERO SLIDER =======
      let heroIndex = 0;
      const heroImage = document.getElementById("heroImage");
      const heroDots = document.getElementById("heroDots");

      function updateHero() {
        if (!nowShowingMovies.length) return;
        heroImage.src = nowShowingMovies[heroIndex].image || placeholder;

        // Update active dot
        [...heroDots.children].forEach((dot, i) =>
          dot.classList.toggle("active", i === heroIndex)
        );
      }

      // Create dots for slider
      nowShowingMovies.forEach((_, i) => {
        const dot = document.createElement("div");
        dot.className = "dot";
        dot.onclick = () => {
          heroIndex = i;
          updateHero();
        };
        heroDots.appendChild(dot);
      });

      updateHero();
      setInterval(() => {
        heroIndex = (heroIndex + 1) % nowShowingMovies.length;
        updateHero();
      }, 5000);

      // ======= NOW SHOWING GRID =======
      const movieGrid = document.getElementById("movieGrid");
      movieGrid.innerHTML = nowShowingMovies
        .map(
          (movie) => `
      <div class="movie-card">
        <img src="${movie.image || placeholder}" alt="${movie.title}">
        <div class="movie-info">
          <h4>${movie.title}</h4>
          <p>${movie.genre || ""} • ${movie.duration || ""}</p>
          <p>${movie.day ? movie.day : ""}${
            movie.date ? " • " + movie.date : ""
          }${movie.time ? " • " + movie.time : ""}</p>
          <button onclick='viewMovie(${JSON.stringify(movie)})'>View</button>
          <button onclick='bookMovie(${JSON.stringify(
            movie
          )})'>Book Now</button>
        </div>
      </div>
    `
        )
        .join("");

      // ======= UPCOMING MOVIES GRID =======
      const upcomingGrid = document.getElementById("upcomingGrid");
      upcomingGrid.innerHTML = upcomingMoviesList
        .map(
          (movie) => `
      <div class="movie-card">
        <img src="${movie.image || placeholder}" alt="${movie.title}">
        <div class="movie-info">
          <h4>${movie.title}</h4>
          <p>${movie.genre || ""} • ${movie.duration || ""}</p>
          <p>Release: ${movie.date || ""}</p>
          <button onclick='viewMovie(${JSON.stringify(movie)})'>View</button>
        </div>
      </div>
    `
        )
        .join("");

      // ======= VIEW / BOOK MOVIE FUNCTIONS =======
      function viewMovie(movie) {
        localStorage.setItem("selectedMovie", JSON.stringify(movie));
        location.href = "page.html"; // Redirect to movie details page
      }

      function bookMovie(movie) {
        localStorage.setItem("selectedMovie", JSON.stringify(movie));
        location.href = "seat2.html"; // Redirect to seat selection page
      }

      // ======= TRAILER PLAYER =======
      let trailerIndex = 0;
      const trailerPlayer = document.getElementById("trailerPlayer");

      function loadTrailer() {
        if (!allTrailers.length) {
          trailerPlayer.style.display = "none";
          return;
        }
        trailerPlayer.src = allTrailers[trailerIndex].trailerUrl;
        trailerPlayer.muted = true;
        trailerPlayer.pause();
      }

      document.getElementById("watchTrailerBtn").onclick = () => {
        trailerPlayer.muted = false;
        trailerPlayer.play();
      };

      document.getElementById("nextTrailerBtn").onclick = () => {
        trailerIndex = (trailerIndex + 1) % allTrailers.length;
        loadTrailer();
      };

      loadTrailer();
    </script>
  </body>
</html>
